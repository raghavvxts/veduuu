<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Vedanshi ðŸ’—</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --spot-x:50%;
  --spot-y:45%;
}
body{
  overflow:hidden;
  background:#0a0a0f;
  font-family:'Poppins',sans-serif;
  color:#f6c1d8;
  min-height:100vh;
}

canvas{position:fixed;top:0;left:0;z-index:0;}

/* SPOTLIGHT OVERLAY - Cupid's divine light */
#spotlight{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:4;
  background:radial-gradient(
    ellipse 60% 60% at var(--spot-x) var(--spot-y),
    rgba(246,193,216,0.18) 0%,
    rgba(246,193,216,0.10) 22%,
    transparent 50%
  );
  opacity:0;
  transition:opacity 1.5s ease;
}
#spotlight.active{opacity:1;}

/* SCREENS */
.screen{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  z-index:5;
  padding:20px;
  opacity:0;
  visibility:hidden;
  transition:opacity 0.8s ease, visibility 0.8s ease;
}

.screen.active{
  opacity:1;
  visibility:visible;
}

/* SCREEN 1: LANDING */
#landing h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(32px,6vw,56px);
  margin-bottom:12px;
  letter-spacing:2px;
  text-shadow:0 0 40px rgba(246,193,216,0.5);
}
#landing .tagline{
  font-size:clamp(18px,3vw,26px);
  font-weight:300;
  margin:0 auto 46px;
  max-width:420px;
  opacity:0.95;
}
#enterBtn{
  padding:16px 40px;
  border:2px solid #f6c1d8;
  background:transparent;
  color:#f6c1d8;
  font-size:18px;
  border-radius:50px;
  cursor:pointer;
  transition:all 0.4s ease;
  font-family:'Poppins',sans-serif;
}
#enterBtn:hover{
  background:#f6c1d8;
  color:#0a0a0f;
  transform:scale(1.05);
  box-shadow:0 0 30px rgba(246,193,216,0.6);
}

/* INTRO CUPID OVERLAY */
#introCupid{
  position:fixed;
  inset:0;
  z-index:6;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  padding-left:min(12vw,140px);
  background:rgba(0,0,0,0.9);
  pointer-events:none;
  opacity:1;
  transition:opacity 1s ease, visibility 1s ease;
}
#introCupid.hidden{
  opacity:0;
  visibility:hidden;
}
#introCupid .cupid-wrap{
  position:relative;
  text-align:center;
  max-width:420px;
  width:min(60vw,420px);
}
#introCupid svg{
  width:100%;
  height:auto;
  filter:drop-shadow(0 0 60px rgba(255,182,193,0.85));
}
#introArrow{
  position:fixed;
  width:140px;
  height:3px;
  background:linear-gradient(90deg,#f6c1d8,#ff6b9c);
  border-radius:3px;
  transform-origin:left center;
  transform:rotate(-15deg);
}
#introArrow::after{
  content:'';
  position:absolute;
  right:-8px;
  top:-3px;
  border-left:10px solid #ff6b9c;
  border-top:6px solid transparent;
  border-bottom:6px solid transparent;
}
#introText{
  margin-top:30px;
  font-family:'Playfair Display',serif;
  font-size:clamp(16px,2vw,22px);
  letter-spacing:1px;
}

/* FLASH + TITLE CARD (MOVIE STYLE) */
#flash{
  position:fixed;
  inset:0;
  background:#ffffff;
  opacity:0;
  pointer-events:none;
  z-index:8;
  transition:opacity 0.3s ease;
}
#flash.active{
  opacity:1;
}

#titleCard{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  background:rgba(0,0,0,0.94);
  z-index:7;
  opacity:0;
  visibility:hidden;
  pointer-events:none;
  transition:opacity 1s ease, visibility 1s ease;
}
#titleCard.active{
  opacity:1;
  visibility:visible;
}
#titleCard .title-inner h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(34px,6vw,64px);
  letter-spacing:0.12em;
  text-transform:uppercase;
  margin-bottom:14px;
}
#titleCard .title-inner p{
  font-size:clamp(14px,2vw,20px);
  opacity:0.9;
}

/* MUSIC START BUTTON (for autoplay rules) */
#musicGate{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9;
  pointer-events:auto;
  background:#020209;
  transition:opacity 0.6s ease;
}
#musicGate.hidden{
  opacity:0;
  pointer-events:none;
}
#musicGate button{
  padding:10px 22px;
  border-radius:999px;
  border:1px solid rgba(246,193,216,0.8);
  background:rgba(246,193,216,0.12);
  color:#f6c1d8;
  font-size:13px;
  cursor:pointer;
  backdrop-filter:blur(10px);
  transition:all 0.3s ease;
}
#musicGate button:hover{
  background:rgba(246,193,216,0.15);
  box-shadow:0 0 18px rgba(246,193,216,0.5);
}
/* FLOATING HEARTS ON LANDING */
.heart{
  position:absolute;
  font-size:20px;
  opacity:0.4;
  animation:floatHeart 8s infinite ease-in-out;
}
@keyframes floatHeart{
  0%,100%{transform:translateY(100vh) rotate(0deg);opacity:0;}
  10%{opacity:0.4;}
  90%{opacity:0.3;}
  100%{transform:translateY(-100px) rotate(360deg);opacity:0;}
}

/* PROPOSAL MICROâ€‘ANIMATIONS */
@keyframes proposalBreath{
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.03);}
}
@keyframes shootingStar{
  0%{opacity:0;transform:translate(-40%,20%) scaleX(1);}
  10%{opacity:1;}
  100%{opacity:0;transform:translate(140%,-40%) scaleX(1);}
}

/* FINAL NAME CONSTELLATION */
.name-const-wrap{
  position:relative;
  width:100%;
  max-width:520px;
  height:150px;
  margin:26px auto 0;
  overflow:hidden;
}
.name-const-star{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  background:#f6c1d8;
  box-shadow:0 0 14px rgba(246,193,216,0.9);
}
.name-const-line{
  position:absolute;
  height:2px;
  background:rgba(246,193,216,0.85);
  transform-origin:left center;
  box-shadow:0 0 10px rgba(246,193,216,0.8);
  opacity:0;
  transition:opacity .35s ease-out;
}

/* SCREEN 2: QUIZ */
#quiz .question-box{
  background:rgba(20,20,30,0.8);
  border:1px solid rgba(246,193,216,0.3);
  border-radius:20px;
  padding:30px 40px;
  max-width:500px;
  backdrop-filter:blur(10px);
}
#quiz h2{
  font-family:'Playfair Display',serif;
  font-size:clamp(20px,3vw,28px);
  margin-bottom:25px;
  line-height:1.4;
}
.quiz-options{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  justify-content:center;
}
.quiz-option{
  padding:14px 24px;
  border:2px solid rgba(246,193,216,0.4);
  background:rgba(246,193,216,0.1);
  color:#f6c1d8;
  border-radius:30px;
  cursor:pointer;
  font-size:15px;
  transition:all 0.3s ease;
}
.quiz-option:hover{
  background:rgba(246,193,216,0.25);
  transform:scale(1.05);
  box-shadow:0 0 20px rgba(246,193,216,0.3);
}
.quiz-progress{
  margin-top:20px;
  font-size:12px;
  opacity:0.7;
}
.skip-quiz{
  margin-top:20px;
  padding:8px 16px;
  background:transparent;
  border:1px solid rgba(246,193,216,0.4);
  color:rgba(246,193,216,0.8);
  border-radius:20px;
  font-size:12px;
  cursor:pointer;
  transition:all 0.3s ease;
}
.skip-quiz:hover{
  background:rgba(246,193,216,0.15);
}

/* SCREEN 3: MAIN PROPOSAL */
#proposal #photo{
  position:relative;
  width:min(28vw,220px);
  height:min(28vw,220px);
  border-radius:50%;
  background:url("us2.jpg") center/cover no-repeat;
  box-shadow:0 0 60px rgba(255,182,193,0.9),0 0 120px rgba(255,182,193,0.4);
  margin-bottom:25px;
  animation:photoGlow 3s ease-in-out infinite alternate;
}
#proposal #photo::after{
  content:'';
  position:absolute;
  top:25%;
  left:-30%;
  width:120%;
  height:2px;
  background:linear-gradient(90deg,transparent,#ffffff,#f6c1d8,transparent);
  opacity:0;
  transform-origin:left center;
  animation:shootingStar 2.8s linear 1 forwards;
  animation-delay:4s;
}
@keyframes photoGlow{
  from{box-shadow:0 0 50px rgba(255,182,193,0.8),0 0 100px rgba(255,182,193,0.3);}
  to{box-shadow:0 0 70px rgba(255,182,193,1),0 0 140px rgba(255,182,193,0.5);}
}

#proposal h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(28px,4vw,44px);
  margin-bottom:10px;
  animation:proposalBreath 6s ease-in-out infinite;
  animation-delay:3s;
}
#proposal h2{
  font-size:clamp(14px,2vw,18px);
  font-weight:300;
  margin-bottom:30px;
}
.btn-wrap{position:relative;min-height:50px;}
.no-message{
  margin-top:18px;
  font-size:13px;
  opacity:0.85;
}
#yes{
  padding:14px 32px;
  border:none;
  border-radius:40px;
  font-size:clamp(14px,1.5vw,16px);
  background:linear-gradient(135deg,#f6c1d8,#ffb6c1);
  color:#1a1a1a;
  cursor:pointer;
  transition:all 0.3s ease;
  font-weight:500;
  box-shadow:0 4px 20px rgba(246,193,216,0.5);
  --yes-scale:1;
  transform:scale(var(--yes-scale));
}
#yes:hover{
  transform:scale(calc(var(--yes-scale) * 1.08));
  box-shadow:0 6px 30px rgba(246,193,216,0.7);
}
@keyframes yesDance{
  0%,100%{transform:scale(var(--yes-scale)) translateY(0) rotate(0deg);}
  25%{transform:scale(var(--yes-scale)) translateY(-3px) rotate(-1deg);}
  50%{transform:scale(calc(var(--yes-scale) * 1.06)) translateY(0) rotate(1deg);}
  75%{transform:scale(var(--yes-scale)) translateY(-2px) rotate(-1deg);}
}
#yes.yes-dance{
  animation:yesDance 0.5s ease-in-out;
}

#no{
  padding:12px 28px;
  border:1px solid rgba(255,255,255,0.2);
  background:rgba(50,50,60,0.6);
  color:#999;
  border-radius:40px;
  font-size:14px;
  cursor:pointer;
  transition:all 0.2s ease;
  font-family:'Poppins',sans-serif;
}
#no:hover{
  color:#ccc;
  transform:translateY(-1px);
  box-shadow:0 0 10px rgba(255,255,255,0.15);
}

/* CUPID CHARACTER */
#cupid{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) scale(0);
  z-index:10;
  pointer-events:none;
  transition:transform 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
#cupid.visible{
  transform:translate(-50%,-50%) scale(1);
}
#cupid svg{
  width:180px;
  height:180px;
  filter:drop-shadow(0 0 30px rgba(255,182,193,0.8));
}
.cupid-arrow{
  transform-origin:75px 50px;
  animation:arrowFly 1.5s ease-out 0.6s forwards;
  opacity:0;
}
@keyframes arrowFly{
  0%{transform:translate(0,0) scale(1);opacity:1;}
  100%{transform:translate(80px,-40px) scale(1.2);opacity:0.9;}
}

/* SCREEN 4: SUCCESS */
#success{
  z-index:15;
}
#cosmicYes{
  font-family:'Playfair Display',serif;
  font-size:clamp(36px,6vw,72px);
  color:#f6c1d8;
  text-shadow:0 0 80px rgba(255,182,193,1),0 0 120px rgba(255,182,193,0.6);
  margin-bottom:20px;
  animation:successPulse 2s ease-in-out infinite;
}
@keyframes successPulse{
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.02);}
}
#success .sub{
  font-size:clamp(16px,2vw,22px);
  opacity:0.9;
  margin-bottom:40px;
}
.confetti{position:fixed;pointer-events:none;z-index:14;}
</style>
</head>
<body>

<audio id="music" src="song.mp3" autoplay loop></audio>

<div id="spotlight"></div>

<div id="flash"></div>

<div id="titleCard">
  <div class="title-inner">
    <h1>A Cosmic Story</h1>
    <p>for Vedanshi ðŸ’—</p>
  </div>
</div>

<!-- tiny music start button (disappears after click) -->
<div id="musicGate">
  <button id="musicBtn">Yupp! ðŸŽµ</button>
</div>

<!-- INTRO CUPID CINEMATIC (CONSTELLATION STYLE) -->
<div id="introCupid">
  <div class="cupid-wrap">
    <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <radialGradient id="introGlow" cx="38%" cy="38%" r="45%">
          <stop offset="0%" stop-color="#ffffff" stop-opacity="1"/>
          <stop offset="40%" stop-color="#ffe4f0" stop-opacity="0.9"/>
          <stop offset="100%" stop-color="#0a0a0f" stop-opacity="0"/>
        </radialGradient>
      </defs>
      <!-- soft glow behind cupid -->
      <circle cx="40" cy="46" r="32" fill="url(#introGlow)"/>
      <!-- simple standing cupid made of stars, facing right -->
      <g stroke="#f6c1d8" stroke-width="1.1" fill="none" stroke-linecap="round">
        <!-- head -->
        <path d="M 40 24 L 40 30" stroke-dasharray="2 3"/>
        <!-- torso (slight lean) -->
        <path d="M 40 30 L 44 56" stroke-dasharray="2 3"/>
        <!-- front leg -->
        <path d="M 44 56 L 48 80" stroke-dasharray="2 3"/>
        <!-- back leg -->
        <path d="M 44 56 L 36 80" stroke-dasharray="2 3"/>
        <!-- wing -->
        <path d="M 34 34 Q 26 40 24 50" stroke-dasharray="2 3"/>
        <!-- arm holding bow (left arm) -->
        <path d="M 44 40 L 32 44" stroke-dasharray="2 3"/>
        <!-- bow curve on left -->
        <path d="M 30 46 Q 26 40 30 34" stroke-dasharray="2 3"/>
        <!-- arrow nocked, pointing right -->
        <path d="M 32 40 L 64 36" stroke-dasharray="2 3"/>
      </g>
      <!-- bright star joints -->
      <g fill="#ffffff">
        <circle cx="40" cy="24" r="1.7"/>
        <circle cx="40" cy="30" r="1.7"/>
        <circle cx="44" cy="40" r="1.6"/>
        <circle cx="32" cy="44" r="1.5"/>
        <circle cx="30" cy="46" r="1.4"/>
        <circle cx="44" cy="56" r="1.8"/>
        <circle cx="48" cy="80" r="1.6"/>
        <circle cx="36" cy="80" r="1.6"/>
        <circle cx="34" cy="34" r="1.4"/>
        <circle cx="24" cy="50" r="1.3"/>
        <circle cx="64" cy="36" r="1.6"/>
      </g>
    </svg>
    <div id="introArrow"></div>
    <div id="introText">A little god of love is aiming just for you...</div>
  </div>
</div>

<!-- SCREEN 1: LANDING -->
<div id="landing" class="screen active">
  <div id="hearts"></div>
  <p class="tagline">Something mildly unhinged is waiting for you...</p>
  <button id="enterBtn">Enter âœ¨</button>
</div>

<!-- SCREEN 2: QUIZ -->
<div id="quiz" class="screen">
  <div class="question-box">
    <h2 id="quizQuestion">What makes the stars shine brighter?</h2>
    <div class="quiz-options" id="quizOptions"></div>
    <p class="quiz-progress" id="quizProgress">Question 1 of 4</p>
    <button class="skip-quiz" id="skipQuiz">Skip to the question â†’</button>
  </div>
</div>

<!-- SCREEN 3: MAIN PROPOSAL -->
<div id="proposal" class="screen">
  <div id="photo"></div>
  <h1>Will you be my prom date?</h1>
  <h2>Vedanshi ðŸ’—</h2>
  <div class="btn-wrap">
    <button id="yes">Okiee Yaawr ðŸ’—</button>
    <button id="no">No</button>
  </div>
  <p id="noMessage" class="no-message"></p>
</div>

<!-- CUPID -->
<div id="cupid">
  <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="cupidGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#ffb6c1"/>
        <stop offset="100%" style="stop-color:#f6c1d8"/>
      </linearGradient>
      <filter id="glow"><feGaussianBlur stdDeviation="2"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <!-- Cupid body -->
    <ellipse cx="50" cy="75" rx="18" ry="25" fill="url(#cupidGrad)" filter="url(#glow)"/>
    <circle cx="50" cy="35" r="22" fill="url(#cupidGrad)"/>
    <!-- Bow -->
    <path d="M 25 50 Q 50 35 75 50 Q 50 65 25 50" fill="none" stroke="#f6c1d8" stroke-width="3"/>
    <!-- Arrow -->
    <line class="cupid-arrow" x1="75" y1="50" x2="95" y2="30" stroke="#f6c1d8" stroke-width="2"/>
    <polygon class="cupid-arrow" points="95,30 90,35 95,35" fill="#f6c1d8"/>
    <!-- Wings -->
    <path d="M 30 55 Q 10 45 15 70 Q 25 60 30 55" fill="rgba(255,255,255,0.4)"/>
    <path d="M 70 55 Q 90 45 85 70 Q 75 60 70 55" fill="rgba(255,255,255,0.4)"/>
  </svg>
</div>

<!-- SCREEN 4: SUCCESS -->
<div id="success" class="screen">
  <h1 id="cosmicYes">A Cosmic Yes.</h1>
  <p class="sub">See you at the stars, Vedanshi ðŸ’—</p>
  <div id="confetti"></div>
  <div id="nameConst" class="name-const-wrap"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// === SCREEN NAVIGATION ===
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  const el = document.getElementById(id);
  if (el) el.classList.add('active');
}

// === INTRO CUPID CINEMATIC ===
const introCupid = document.getElementById('introCupid');
const introArrow = document.getElementById('introArrow');
const flash = document.getElementById('flash');
const titleCard = document.getElementById('titleCard');
const music = document.getElementById('music');
const musicGate = document.getElementById('musicGate');
const musicBtn = document.getElementById('musicBtn');
let introRunning = true;
let introStartTime = null;
let spotX = 32;
let spotY = 52;

function safePlayMusic(){
  if(!music) return;
  // try play; if blocked, next user click handler will retry
  try{ music.play(); }catch(e){}
}

function startIntro(){
  // hide all content screens while intro plays
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  // try to start music as early as possible
  safePlayMusic();
  requestAnimationFrame(stepIntro);
}

function stepIntro(timestamp){
  if(!introRunning) return;
  if(introStartTime===null) introStartTime = timestamp;
  const duration = 4500;
  const t = Math.min(1, (timestamp - introStartTime) / duration);

  // arrow starts near cupid's bow on the left and flies across to the right
  const startX = 32, endX = 86;
  const startY = 52, endY = 40;
  const x = startX + (endX - startX) * t;
  const y = startY + (endY - startY) * t;

  // move arrow exactly with path
  introArrow.style.left = x + '%';
  introArrow.style.top = y + '%';

  // ease spotlight slightly behind arrow for smoother feeling
  const lerpFactor = 0.15;
  spotX = spotX + (x - spotX) * lerpFactor;
  spotY = spotY + (y - spotY) * lerpFactor;
  document.documentElement.style.setProperty('--spot-x', spotX + '%');
  document.documentElement.style.setProperty('--spot-y', spotY + '%');

  if(t < 1){
    requestAnimationFrame(stepIntro);
  }else{
    // arrow impact: small burst, flash, then title card
    spawnConfetti();
    introRunning = false;
    if(flash){
      flash.classList.add('active');
      setTimeout(()=>flash.classList.remove('active'),350);
    }
    setTimeout(()=>{
      introCupid.classList.add('hidden');
      if(titleCard){
        titleCard.classList.add('active');
      }else{
        showScreen('landing');
      }
    },800);
    if(titleCard){
      setTimeout(()=>{
        titleCard.classList.remove('active');
        showScreen('landing');
      },3200);
    }
  }
}

// Safari/Chrome autoplay guard: if autoplay is blocked, play on first user interaction
if(music && musicBtn && musicGate){
  musicBtn.onclick = ()=>{
    safePlayMusic();
    musicGate.classList.add('hidden');
    // start the whole cinematic only after she taps
    startIntro();
  };
} else {
  // fallback: if button missing, start intro immediately
  startIntro();
}

// (Hearts row removed to keep the first screen subtle)
document.getElementById('enterBtn').onclick=()=>showScreen('quiz');

// === QUIZ ===
const quizData=[
  {q:"What makes the stars shine brighter?",a:["Your smile","Clouds","The moon","Random stuff"]},
  {q:"If we went to an F1 race together, what would be the coolest part? ðŸŽï¸",a:["Hearing the cars scream past on the main straight ðŸ”Š","Watching an insane lastâ€‘lap overtake for the win âš¡","Walking the paddock pretending we own a team ðŸ˜Ž","Arguing about which driverâ€™s race pace is actually better ðŸ’¬"]},
  {q:"If you suddenly woke up as Spiderâ€‘Man, whatâ€™s the FIRST very unserious thing youâ€™d do? ðŸ•·ï¸",a:["Swing into class through the window just to avoid the door","Use webâ€‘shooters to steal snacks from the vending machine","Web peopleâ€™s phones to the ceiling when they say \"one last reel\"","Settle every argument by saying \"My Spideyâ€‘sense says Iâ€™m right\""]},
  {q:"Ready for the big question?",a:["Yes!","Of course!","Absolutely!","Let's go!"]}
];
let quizIdx=0;

function renderQuiz(){
  const d=quizData[quizIdx];
  document.getElementById('quizQuestion').textContent=d.q;
  const opts=document.getElementById('quizOptions');
  opts.innerHTML='';
  d.a.forEach((ans)=>{
    const b=document.createElement('button');
    b.className='quiz-option';
    b.textContent=ans;
    b.onclick=()=>{
      quizIdx++;
      if(quizIdx>=quizData.length){
        showScreen('proposal');
        document.getElementById('spotlight').classList.add('active');
        document.documentElement.style.setProperty('--spot-x','50%');
        document.documentElement.style.setProperty('--spot-y','45%');
      } else {
        renderQuiz();
        document.getElementById('quizProgress').textContent=`Question ${quizIdx+1} of 4`;
      }
    };
    opts.appendChild(b);
  });
}

document.getElementById('skipQuiz').onclick=()=>{
  quizIdx=quizData.length;
  showScreen('proposal');
  document.getElementById('spotlight').classList.add('active');
  document.documentElement.style.setProperty('--spot-x','50%');
  document.documentElement.style.setProperty('--spot-y','45%');
};
renderQuiz();

// === THREE.JS ===
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,10000);
let renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.insertBefore(renderer.domElement,document.body.firstChild);

camera.position.z=1200;

window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

const starGeo=new THREE.BufferGeometry();
const starCount=60000;
const positions=[];
for(let i=0;i<starCount;i++){
  positions.push((Math.random()-0.5)*8000,(Math.random()-0.5)*6000,Math.random()*-6000);
}
starGeo.setAttribute('position',new THREE.Float32BufferAttribute(positions,3));
const stars=new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1.4}));
scene.add(stars);

let warp=false,warpSpeed=0;
let comet,halo,cometTrail=[],cometActive=false,cometProgress=0;

function reseedStars(){
  const arr=starGeo.attributes.position.array;
  for(let i=0;i<arr.length;i+=3){
    arr[i]=(Math.random()-0.5)*8000;
    arr[i+1]=(Math.random()-0.5)*6000;
    arr[i+2]=Math.random()*-6000;
  }
  starGeo.attributes.position.needsUpdate=true;
}

function drawNameConstellation(){
  const wrap=document.getElementById('nameConst');
  if(!wrap) return;
  wrap.innerHTML='';

  const letters={
    V:{points:[[0,0],[20,55],[40,0]],lines:[[0,1],[1,2]]},
    E:{points:[[40,0],[0,0],[0,55],[40,55],[0,27],[32,27]],lines:[[0,1],[1,2],[2,3],[2,4],[4,5]]},
    D:{points:[[0,0],[0,55],[30,45],[40,27],[30,10],[0,0]],lines:[[0,1],[1,2],[2,3],[3,4],[4,5]]},
    A:{points:[[0,55],[20,0],[40,55],[10,30],[30,30]],lines:[[0,1],[1,2],[3,4]]},
    N:{points:[[0,55],[0,0],[40,55],[40,0]],lines:[[0,1],[1,2],[2,3]]},
    S:{points:[[40,0],[0,0],[0,27],[40,27],[40,55],[0,55]],lines:[[0,1],[1,2],[2,3],[3,4],[4,5]]},
    H:{points:[[0,0],[0,55],[40,0],[40,55],[0,27],[40,27]],lines:[[0,1],[2,3],[4,5]]},
    I:{points:[[20,0],[20,55]],lines:[[0,1]]}
  };

  const name="VEDANSHI";
  const baseSpacing=55;
  const scale=Math.min(1,(wrap.clientWidth-20)/(name.length*baseSpacing));
  const spacing=baseSpacing*scale;
  const startX=(wrap.clientWidth-(name.length*spacing))/2;
  const baseY=20;

  let offsetX=startX;
  let delay=0;

  for(const char of name){
    const data=letters[char];
    const pts=data.points;

    pts.forEach(p=>{
      const s=document.createElement('div');
      s.className='name-const-star';
      s.style.left=(offsetX+p[0]*scale)+'px';
      s.style.top=(baseY+p[1]*scale)+'px';
      wrap.appendChild(s);
    });

    data.lines.forEach(pair=>{
      const [i,j]=pair;
      const x1=offsetX+pts[i][0]*scale;
      const y1=baseY+pts[i][1]*scale;
      const x2=offsetX+pts[j][0]*scale;
      const y2=baseY+pts[j][1]*scale;

      const l=document.createElement('div');
      l.className='name-const-line';
      l.style.left=x1+'px';
      l.style.top=y1+'px';
      const dx=x2-x1;
      const dy=y2-y1;
      l.style.width=Math.hypot(dx,dy)+'px';
      l.style.transform=`rotate(${Math.atan2(dy,dx)}rad)`;
      wrap.appendChild(l);

      setTimeout(()=>{l.style.opacity='1';},delay);
      delay+=160;
    });

    offsetX+=spacing;
  }
}

function createComet(){
  const geometry=new THREE.SphereGeometry(10,16,16);
  const material=new THREE.MeshBasicMaterial({color:0xf6c1d8});
  comet=new THREE.Mesh(geometry,material);
  const haloGeo=new THREE.SphereGeometry(30,16,16);
  const haloMat=new THREE.MeshBasicMaterial({color:0xf6c1d8,transparent:true,opacity:0.25});
  halo=new THREE.Mesh(haloGeo,haloMat);
  comet.position.set(-window.innerWidth,-window.innerHeight/2,-800);
  halo.position.copy(comet.position);
  scene.add(comet);scene.add(halo);
  cometActive=true;cometProgress=0;
}

function createTrail(x,y,z){
  const geo=new THREE.SphereGeometry(6,10,10);
  const mat=new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:1});
  const p=new THREE.Mesh(geo,mat);
  p.position.set(x,y,z);
  scene.add(p);
  cometTrail.push(p);
}

function animate(){
  requestAnimationFrame(animate);
  if(warp){
    let arr=starGeo.attributes.position.array;
    for(let i=2;i<arr.length;i+=3){
      arr[i]+=warpSpeed;
      if(arr[i]>0)arr[i]=-6000;
    }
    starGeo.attributes.position.needsUpdate=true;
  } else {
    stars.rotation.y+=0.00025;
  }

  if(cometActive){
    cometProgress+=0.015;
    let x=-2000+cometProgress*4000;
    let y=Math.sin(cometProgress*Math.PI)*800;
    comet.position.set(x,y,-800);
    halo.position.copy(comet.position);
    // denser star trail
    createTrail(x,y,-800);
    createTrail(x+40,y+20,-820);
    cometTrail.forEach((p,i)=>{
      p.scale.multiplyScalar(0.97);
      p.material.opacity-=0.01;
      if(p.material.opacity<=0){scene.remove(p);cometTrail.splice(i,1);}
    });
    if(cometProgress>=1){
      cometActive=false;
      scene.remove(comet);scene.remove(halo);
      warpSpeed=8;
      setTimeout(()=>{
        showScreen('success');
        spawnConfetti();
        drawNameConstellation();
        // calm background for ending screen
        document.getElementById('spotlight').classList.remove('active');
        warp=false;
        warpSpeed=0;
        reseedStars();
      },2600);
    }
  }
  renderer.render(scene,camera);
}
animate();

// === YES CLICK ===
document.getElementById('yes').onclick=function(){
  const music = document.getElementById('music');
  if (music) {
    try { music.play(); } catch(e) {}
  }
  document.getElementById('proposal').style.opacity='0';
  document.getElementById('proposal').style.pointerEvents='none';
  setTimeout(()=>{
    document.getElementById('proposal').style.display='none';
  },800);
  warp=true;
  warpSpeed=30;
  createComet();
};

// === NO BUTTON - RUNS AWAY ===
let noClicks=0;
const noBtn=document.getElementById('no');
const noMsg=document.getElementById('noMessage');
noBtn.onclick=function(){
  noClicks++;
  const msgs=[
    "Really? ðŸ˜¢",
    "Are you sure? ðŸ˜­",
    "You are evil! ðŸ’”",
    "My heart is breaking here... ðŸ˜­",
    "Last chance before Cupid cries ðŸ˜­"
  ];
  noMsg.textContent = msgs[Math.min(noClicks-1,msgs.length-1)];

  const yesBtn = document.getElementById('yes');
  if (yesBtn){
    const scale = Math.min(1.6, 1 + noClicks * 0.08);
    yesBtn.style.setProperty('--yes-scale', scale.toString());
    yesBtn.classList.remove('yes-dance');
    // force reflow so animation can restart
    void yesBtn.offsetWidth;
    yesBtn.classList.add('yes-dance');
  }
};

// === CONFETTI ===
function spawnConfetti(){
  const colors=['#ffffff','#ffe4f0','#f6c1d8'];
  const c=document.getElementById('confetti');
  for(let i=0;i<80;i++){
    const p=document.createElement('span');
    p.className='confetti';
    p.textContent='';
    p.style.width='6px';
    p.style.height='6px';
    p.style.borderRadius='50%';
    p.style.background=colors[Math.floor(Math.random()*colors.length)];
    p.style.cssText+=`left:${40+Math.random()*20}vw;top:${35+Math.random()*20}vh;animation:confettiFall ${2.5+Math.random()}s ease-out forwards;`;
    c.appendChild(p);
    setTimeout(()=>p.remove(),5000);
  }
}
const style=document.createElement('style');
style.textContent=`@keyframes confettiFall{0%{transform:translateY(-20px) rotate(0deg);opacity:1;}100%{transform:translateY(100vh) rotate(720deg);opacity:0;}}`;
document.head.appendChild(style);
</script>
</body>
</html>
